<% provide(:title, @detection.code) %>
<script>
</script>

<h2>Classification</h2>

<!-- preload images -->
	<% if params[:pos_page].nil? and  params[:neg_page].nil? and @detection.currId == 0 %>
		<% @detection.positive_training.keys.each do |code| %>
			<%= image_tag(@detection.positive_training[code][1], width: 0, height: 0, border: 0, alt: ""  ) %>
		<% end %>
		<% @detection.negative_training.keys.each do |code| %>
			<%= image_tag(@detection.negative_training[code][1], width: 0, height: 0, border: 0, alt: ""  ) %>
		<% end %>
	<% else %>
		<p>&nbsp;</p>
	<% end %>

<!-- Intro -->
<div class="row-fluid">
	<div class="span1 pull-left eqh">
		<section>
			<p class="text-info"><em>Code:</em></p>
			<h5>
				<%= @detection.code %>
			</h5>
		</section>
	</div>
	<div class="span11 well well-small pull-right eqhBase">
		<div class="row-fluid">
			<div class="span10 offset1">
				<p>
					Please give your best guess for the example below. We know that many samples are very difficult. Each image we show has the same probability.
				</p>
				<dl>
					<dt>
						DEFINITELY MITOSIS
					</dt>
					<dd>
						there is a mitotic nucleus right at the center of this image
					</dd>
					<dt>
						UNSURE, PROBABLY MITOSIS
					</dt>
					<dd>
						inclined towards the presence of a mitotic nucleus at the center of this image
					</dd>
					<dt>
						UNSURE, PROBABLY NONMITOSIS
					</dt>
					<dd>
						inclined towards the absence of a mitotic nucleus in this image
					</dd>
					<dt>
						DEFINITELY NONMITOSIS
					</dt>
					<dd>
						there is no mitotic nucleus in this image
					</dd>

				</dl>
			</div>
		</div>
	</div>
</div>


<!-- TRAINING SAMPLES -->
<div class="row-fluid">
	<div class="span6 well pull-left">
		<a name="samples"></a>
		<div class="row-fluid">
			<div class="span12">
				<p>&nbsp</p>
				<h3><span class="label label-info">Mitotic samples</span></h3>
			</div>
		</div>
		<div class="row-fluid">
			<div class="span12">
				<% (0..2).each do |row_index| %>
					<div class="row-fluid">
						<ul class="thumbnails">
							<% (0..5).each do |col_index| %>
								<li class="span2">
									<a href="#samples" class="thumbnail">
										<% code = @positive_keys[row_index * 6 + col_index] %>
										<%= image_tag(@detection.positive_training[code][1], alt: code, title: code) %>
									</a>
								</li>
							<% end %>
						</ul>
					</div>
				<% end %>
			</div>
			<div class="span12 divCenter">
				<p class="text-info">showing samples from <strong><%= (@curr_pos_page - 1) * 18 + 1 %></strong> to 
				<strong><%= @curr_pos_page * 18 %></strong></p>
			</div>
			<div class="pagination pagination-small pagination-centered">
				<%= will_paginate @positive_keys, :param_name => 'pos_page', :params => {:anchor => "samples"} %>
			</div>
		</div>
	</div>
	<div class="span6 well pull-right">
		<div class="row-fluid">
			<div class="span12">
				<p>&nbsp</p>
				<h3><span class="label label-warning">NON Mitotic samples</span></h3>
			</div>
		</div>
		<div class="row-fluid">
			<div class="span12">
				<% (0..2).each do |row_index| %>
					<div class="row-fluid">
						<ul class="thumbnails">
							<% (0..5).each do |col_index| %>
								<li class="span2">
									<a href="#samples" class="thumbnail">
										<% code = @negative_keys[row_index * 6 + col_index] %>
										<%= image_tag(@detection.negative_training[code][1], alt: code, title: code) %>
									</a>
								</li>
							<% end %>
						</ul>
					</div>
				<% end %>
			</div>
			<div class="span12 divCenter">
				<p class="text-info">showing samples from <strong><%= (@curr_neg_page - 1) * 18 + 1 %></strong> to 
				<strong><%= @curr_neg_page * 18 %></strong></p>
			</div>
			<div class="pagination pagination-small pagination-centered">
				<%= will_paginate @negative_keys, :param_name => 'neg_page', :params => {:anchor => "samples"} %>
			</div> 
		</div>
	</div>
</div>

<div class="row-fluid">
	<div class="span12">
		<% flash.each do |key, value| %>
			<div class="divCenter alert alert-<%= key %>"><strong><%= value %></strong></div>
		<% end %>
	</div>
</div>
<!-- -->

	
<div class="row-fluid">
	<div class="span4">
		<h4>Your current performance:</h4>
		<% if @detection.currId < 10 %>
			<p class="text-info">your performance will be available after 10 detections</p>
		<% else %>
			<p class="text-info">Your current F1-score is: <strong><%= @f1score %></strong></p>
		<% end %>
	</div>

	<div div class="span8 well">
				<%= form_tag(save_detection_path(@detection.id), :method=>'get', :multipart => true)  do %>
				<%= hidden_field_tag 'cnp', @curr_neg_page %>
				<%= hidden_field_tag 'cpp', @curr_pos_page %>
		<div class="row-fluid">
			<div class="span3">
				<div class="thumbnail">
					<a href="#samples" class="thumbnail">
						<%= image_tag(@detection.value[@curr_image_code][2], alt: @curr_image_code, title: @curr_image_code) %>
					</a>
				</div>
				<div class="caption divCenter">
                    <p class="text-info"><small>Image <strong><%= @detection.currId + 1 %></strong> of <strong><%= @detection.value.values.length %>
                    </strong></small></p>
                 </div>
			</div>
			<div class="span5">
				<label class="radio">
					<%= radio_button_tag( @curr_image_code, "pp" ) %>Mitosis
				</label>
				<label class="radio">
					<%= radio_button_tag( @curr_image_code, "qp" ) %>Guess Mitosis
				</label>
				<label class="radio">
					<%= radio_button_tag( @curr_image_code, "qn" ) %>Guess NON Mitosis
				</label>
				<label class="radio">
					<%= radio_button_tag( @curr_image_code, "nn" ) %>NON Mitosis
				</label>
			</div>
			<div class="span4">
				<div class="row-fluid">
					<h4>Please select:</h4>
					<div class="span8 offset2 divCenter">
							<%= submit_tag "Classify", class: "btn btn-primary" %>
							<% end %>
					</div>
				</div>
				<div class="row-fluid">
					<div class="span8 offset2 divCenter">
						<p>or</p>
						<%= link_to "Finish", results_detection_path(@detection), class: "btn btn-success" %>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>


